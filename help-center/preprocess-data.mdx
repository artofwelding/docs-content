[Ingest pipelines](app/management/ingest/ingest_pipelines) transform, enrich, and modify documents before they are indexed into Elasticsearch, 
allowing you to preprocess your data in a flexible and scalable manner.

## How does it work?

Ingest pipelines are defined in Elasticsearch and include a series of configurable tasks called processors. Each processor performs an operation on 
the document. For example, a processor can parse, enrich, filter, or modify the document. When you ingest a document into Elasticsearch, the document passes through the ingest pipeline, then
each processor is sequentially applied to the document. 

Processors perform the following operations:

- Enrichment &mdash; Add information from external data sources, such as another index or external database.
- Transformation &mdash; Parse information from your documents to make sure they conform to a standardized format. For example, extract and raname fields, convert data types, and more.
- Filtering &mdash; Specify conditions for processing the documents, which allow you to control the transformed or enriched documents. For example, remove fields from documents, such as sensitive information, before indexing.
- Pipeline handling &mdash; Manage the flow of documents through the pipeline and perform specified actions. For example, handle error exceptions, execute another pipeline, or reroute a document to another index. 
- Array/JSON handling &mdash; Manipulate arrays and JSON objects in documents with structured data formats. For example, run bath processors, parse JSON data, and sort elements. 

For more information, check [Processor reference](https://www.elastic.co/guide/en/elasticsearch/reference/current/processors.html#ingest-processors-categories). 

<DocCallOut title="Tip">
Map your custom data to Elastic Common Schema (ECS), making it easier to search your data and reuse visualizations from other data sets. 
When you create a pipeline, select **New pipeline from CSV**. For more information, check [Map custom data to ECS](https://www.elastic.co/guide/en/ecs/current/ecs-converting.html).
</DocCallOut>

## Test pipelines

Before you use ingest pipelines in production, test them using sample documents.

1. For the pipeline you want to test, open the **Actions* menu, then select **Edit**.
1. Click **Add documents**.
1. On the **Documents** tab, add the sample documents. 
1. Click **Run the pipeline**.

![Documents tab on the Test pipeline window that shows two sample documents in JSON format](./images/ingest-pipelines-test.gif)

## Add a pipeline to an indexing request

Use the `pipeline` query parameter to apply a pipeline to documents in 
[individual](https://docs.elastic.co/api-reference/search/index) or [bulk](https://docs.elastic.co/api-reference/search/bulk) requests.

1. Open [Console](app/dev_tools#/console).
1. Run the following request:

```js
POST my-data-stream/_doc?pipeline=my-pipeline
{
  "@timestamp": "2099-03-07T11:04:05.000Z",
  "my-keyword-field": "foo"
}

PUT my-data-stream/_bulk?pipeline=my-pipeline
{ "create":{ } }
{ "@timestamp": "2099-03-07T11:04:06.000Z", "my-keyword-field": "foo" }
{ "create":{ } }
{ "@timestamp": "2099-03-07T11:04:07.000Z", "my-keyword-field": "bar" }
```

You can also use the `pipeline` parameter with the [update by query](https://docs.elastic.co/api-reference/search/update-by-query) or [reindex](https://docs.elastic.co/api-reference/search/reindex) APIs.

Run the following request:

```js
POST my-data-stream/_update_by_query?pipeline=my-pipeline

POST _reindex
{
  "source": {
    "index": "my-data-stream"
  },
  "dest": {
    "index": "my-new-data-stream",
    "op_type": "create",
    "pipeline": "my-pipeline"
  }
}
```

## Set a default pipeline

To set a default pipeline, use the `index.default_pipeline` index setting. Elasticsearch applies this pipeline to indexing requests if no pipeline parameter is specified.

When the default pipeline is set and the pipeline does not exist, indexing requests fail. To override the default, use the `pipeline` parameter. 
The special pipeline `_none` name indicates no default ingest pipeline will run.

## Set a final pipeline

To set a final pipeline, use the `index.final_pipeline` index setting. Elasticsearch applies this pipeline after the request or default pipeline, even when unspecified.

The final pipeline runs after the specified request pipeline and existing default pipeline. When the final pipeline is set and the pipeline does not exist, indexing requests fail. 
The special pipeline `_none` name indicates no final ingest pipeline will run.

<DocCallOut title="Note">
To change the _index field, you are unable to use a final pipeline. When the pipeline attempts to change the _index field, the indexing request fails.
</DocCallOut>